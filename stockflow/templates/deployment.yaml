{{- range $item := .Values.services}}

apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ $item.name }}
  namespace: {{ $item.namespace }}
  labels:
    app: {{ $item.name }}
spec:
    replicas: {{ $item.replicas }}
    selector:
      matchLabels:
        app: {{ $item.name }}
    template:
      metadata:
        labels:
          app: {{ $item.name }}
      spec:
        {{- if $item.serviceAccountName }}
        serviceAccountName: {{ $item.serviceAccountName }}
        {{- end }}
        containers:
        - name: {{ $item.name }}
          image: {{ $item.image }}:{{ $item.imageVersion }}
          env: {{- include "mychart.renderEnv" $item | nindent 12}}
          imagePullPolicy: Always
          ports: {{- include "mychart.renderPorts" $item | nindent 12}}

---
{{- end}}
